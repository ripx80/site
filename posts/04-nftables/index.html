<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script><link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>nftables - basics | ripx80 onexec</title>
<link rel=canonical href=https://ripx80.de/posts/04-nftables/><meta name=description content="ripx80 technical thoughts and try to memorize yesterday"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="nftables - basics"><meta property="og:description" content="overview of the use of nftables with nix"><meta property="og:type" content="article"><meta property="og:url" content="https://ripx80.de/posts/04-nftables/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-15T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-15T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="nftables - basics"><meta name=twitter:description content="overview of the use of nftables with nix"><link rel=stylesheet href=https://ripx80.de/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><link rel=stylesheet href=https://ripx80.de/css/custom.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://ripx80.de/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>home</a></li><li><a href=/posts>writings</a></li><li><a href=/lib>lib</a></li><li><a href=/tags>tags</a></li><li><a href=/whoami>whoami</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://ripx80.de/posts/03-requirements/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f&text=nftables%20-%20basics" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f&title=nftables%20-%20basics" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f&is_video=false&description=nftables%20-%20basics" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=nftables%20-%20basics&body=Check out this article: https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f&title=nftables%20-%20basics" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f&title=nftables%20-%20basics" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f&name=nftables%20-%20basics&description=overview%20of%20the%20use%20of%20nftables%20with%20nix" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f&t=nftables%20-%20basics" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">nftables - basics</h1><div class=meta><div class=postdate><time datetime="2024-04-15 00:00:00 +0000 UTC" itemprop=datePublished>2024-04-15</time></div><div class=article-read-time><i class="far fa-clock"></i>
9 minute read</div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/network rel=tag>network</a>
,
<a class=tag-link href=/tags/security rel=tag>security</a>
,
<a class=tag-link href=/tags/nix rel=tag>nix</a></div></div></header><div id=toc><nav id=TableOfContents><ul><li><a href=#short>short</a></li><li><a href=#netfilter>netfilter</a></li><li><a href=#nft>nft</a></li><li><a href=#families>families</a></li><li><a href=#nft-monitor>nft monitor</a></li><li><a href=#nftrace>nftrace</a></li><li><a href=#nftables-with-nixos>nftables with nixos</a></li><li><a href=#conclusion>conclusion</a></li><li><a href=#docs>docs</a></li><li><a href=#learned>learned</a></li></ul></nav></div><div class=content itemprop=articleBody><h2 id=short>short</h2><p>nftables is the modern linux kernel (>= 3.13 nft <a href="https://git.netfilter.org/nftables/log/doc?showmsg=1">support</a>) packet classification framework to replace iptables.</p><p>this post will get the basics and useful commands/rules for nftables and some usecases how nftables will configured in case of a nixos system in a default way.</p><p>if you search for a advanced topic i recommend the <strong>nftables advanced router post</strong> (comming soon).
need additional ideas or use cases? take a look at <strong>50 things - nftables</strong> (comming soon).</p><ul><li>system: x86_64</li><li>kernel: 6.7.9</li><li>nixos: 23.11</li><li>nftables: 1.0.9</li><li>libressl-3.8.2-nc</li></ul><p>nixos modules:</p><ul><li><a href=https://github.com/nixos/nixpkgs/blob/nixos-23.11/nixos/modules/services/networking/firewall.nix>firewall</a></li><li><a href=https://github.com/nixos/nixpkgs/blob/nixos-23.11/nixos/modules/services/networking/firewall-nftables.nix>firewall-nftables</a></li><li><a href=https://github.com/nixos/nixpkgs/blob/nixos-23.11/nixos/modules/services/networking/nftables.nix>nftables</a></li></ul><h2 id=netfilter>netfilter</h2><p>&ldquo;the <a href=https://www.netfilter.org/>netfilter</a> project enables packet filtering, network address [and port] translation (na[p]t), packet logging, userspace packet queueing and other packet mangling.</p><p>the netfilter hooks are a framework inside the linux kernel that allows kernel modules to register callback functions at different locations of the linux network stack. the registered callback function is then called back for every packet that traverses the respective hook within the linux network stack.&rdquo; - netfilter.org</p><p>so, netfilter is the linux framework for manipulating network packets. it can filter and transform packets at predefined points in the kernel.</p><p>on top of netfilter sit the firewalls: the venerable iptables, and the new nftables.</p><h2 id=nft>nft</h2><p>nft is the shell command to manipulate nftables. it can list the ruleset, add, delete and change rules in nftables.</p><div class=speechbubble><div class=garry><img src=https://ripx80.de/images/garry-64.webp alt=garry></div><div class=chat><p><span class=whisper></span>
note that the **position** of the statements within your rule is significant, because nftables evaluates expressions and statements linearly from left to right.</p></div></div><p>here are some useful commands to interact with nftables and netfilter which i have used in this journey.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># show</span>
</span></span><span style=display:flex><span>nft list tables                     <span style=color:#75715e># list current tables</span>
</span></span><span style=display:flex><span>nft --stateless list table filter   <span style=color:#75715e># list table filter, omit stateful information like counters</span>
</span></span><span style=display:flex><span>nft -s list ruleset                 <span style=color:#75715e># list all nft instructions</span>
</span></span><span style=display:flex><span>nft -a list chains                  <span style=color:#75715e># list all chains with handle (need to delete)</span>
</span></span><span style=display:flex><span>nft list counters                   <span style=color:#75715e># list all named counters</span>
</span></span><span style=display:flex><span>nft -j list ruleset                 <span style=color:#75715e># output the complete ruleset in json format</span>
</span></span><span style=display:flex><span>nft list ruleset -a                 <span style=color:#75715e># get the handle to delte a rule</span>
</span></span><span style=display:flex><span>nft monitor                         <span style=color:#75715e># see live changes on ruleset</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># manipulate</span>
</span></span><span style=display:flex><span>nft delete rule inet nixos-fw input-allow handle <span style=color:#ae81ff>17</span>     <span style=color:#75715e># delete rule in nixos-fw chain input-allow handle 17</span>
</span></span><span style=display:flex><span>nft add ip chain nat prerouting <span style=color:#e6db74>&#39;{ policy drop; }&#39;</span>      <span style=color:#75715e># add chain prerouting with default policy drop</span>
</span></span><span style=display:flex><span>nft add chain ip nat postrouting <span style=color:#e6db74>&#39;{ policy accept; }&#39;</span>   <span style=color:#75715e># add chain nat postrouting with default policy accept</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># clear</span>
</span></span><span style=display:flex><span>nft flush table ip filter   <span style=color:#75715e># flush only table ip filter</span>
</span></span><span style=display:flex><span>nft flush ruleset           <span style=color:#75715e># flush all rules</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># test</span>
</span></span><span style=display:flex><span>nft -c -o -f ruleset.test   <span style=color:#75715e>#  read the nft file (f), optimize ruleset(o) in dry-run mode (c)</span>
</span></span></code></pre></td></tr></table></div></div><p>if you need more commands like insert or replace take a look at the <a href=https://wiki.nftables.org/wiki-nftables/index.php/quick_reference-nftables_in_10_minutes>nftables wiki</a>.
the dry-run command is a good idea if you want to test your ruleset (syntax not functonally) and not apply directly to your system.</p><p>on nixos systems you can find your nftables evaluated ruleset when you build it from your config with <code>sh nixos-rebuild build --flake .#mysystem</code> in the file
result/etc/systemd/system/nftables.service</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>execstart=/nix/store/ngdbcld1pdh1h8zpn1541c35zv25q6r2-nftables-rules # example path on mysystem
</span></span></code></pre></td></tr></table></div></div><h2 id=families>families</h2><p>nft has different family types to interact with:</p><ul><li>ip: only see ipv4 traffic</li><li>ip6: only see ipv6 traffic</li><li>inet: tables of this family see both ipv4 and ipv6 traffic/packets, simplifying dual stack support.</li><li>arp: arp level traffic</li><li>bridge: traffic/packets traversing bridges</li><li>netdev: the netdev family is different from the others in that it is used to create base chains attached to a single network interface. such base chains see all network traffic on the specified interface, with no assumptions about l2 or l3 protocols.</li></ul><p>for example if you want to create a packet filter for ipv4 and ipv6 you can use inet to handle both in one ruleset.</p><h2 id=nft-monitor>nft monitor</h2><p>with <code>sh nft monitor</code> you can see live rules changes (event based).
for example start nft monitor and then add a rule to your ruleset.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>nft monitor
</span></span><span style=display:flex><span><span style=color:#75715e># different shell</span>
</span></span><span style=display:flex><span>nft add rule inet fw services iif <span style=color:#e6db74>&#34;wg0&#34;</span> tcp dport <span style=color:#ae81ff>443</span> <span style=color:#75715e># open port 443 on wireguard wg0 interface</span>
</span></span><span style=display:flex><span>nft -a list chain services
</span></span></code></pre></td></tr></table></div></div><p>you will see in your monitor shell something like this:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>add rule inet fw services iif <span style=color:#e6db74>&#34;wg0&#34;</span> tcp dport <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span><span style=color:#75715e># new generation 3 by process 397259 (nft)</span>
</span></span></code></pre></td></tr></table></div></div><p>after that we delete this rule. to delete a rule you must get the internal handle of that rule.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>nft -a list chain inet fw services <span style=color:#75715e># get the handle, 19</span>
</span></span><span style=display:flex><span>nft delete rule inet fw services handle <span style=color:#ae81ff>19</span>
</span></span></code></pre></td></tr></table></div></div><p>with nft monitor you will see if some process will change your nft rules. this is useful if you inspect how kubernetes or some container runtimes will manipulate the rules to route traffic to their internal services.</p><h2 id=nftrace>nftrace</h2><p>nftrace is since nftables v0.6 and linux kernel 4.6, ruleset <a href=https://wiki.nftables.org/wiki-nftables/index.php/ruleset_debug/tracing>debug/tracing</a> is supported.
nftrace is part of the metainformation of a packet so you must enable it for a specific packet that you want to debug.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>nft add rule inet fw services iif <span style=color:#e6db74>&#34;wg0&#34;</span> tcp dport <span style=color:#ae81ff>443</span> meta nftrace set <span style=color:#ae81ff>1</span> accept <span style=color:#75715e># open port 443 on wg0 with tracing enabled</span>
</span></span><span style=display:flex><span>nft monitor trace <span style=color:#75715e># start and waiting for events</span>
</span></span></code></pre></td></tr></table></div></div><p>now we connect from another maschine to port 443 on wg0. keep in mind that when you use your localhost and the interface &ldquo;lo&rdquo; is a trusted interface you will not see any event. for testing i use netcat to create a service on mymaschine and connect from the outside</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>nc -l 192.168.1.2 <span style=color:#ae81ff>443</span>   <span style=color:#75715e># listen only on wg0 port 443 tcp</span>
</span></span><span style=display:flex><span>nc 192.168.1.2 <span style=color:#ae81ff>443</span>      <span style=color:#75715e># connect to this port from a external maschine (192.168.100.3)</span>
</span></span></code></pre></td></tr></table></div></div><p>after the connect a event is pop up in monitor</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>trace id 5ac77d91 inet fw services packet: iif &#34;wg0&#34; ip saddr 192.168.1.3 ip daddr 192.168.1.2 ip dscp cs0 ip ecn not-ect ip ttl 64 ip id 1816 ip protocol tcp ip length 60 tcp sport 40776 tcp dport 443 tcp flags == syn tcp window 32160
</span></span><span style=display:flex><span>trace id 5ac77d91 inet fw services unknown rule handle 22 (verdict accept)
</span></span></code></pre></td></tr></table></div></div><p>we get a lot of information here:</p><ul><li>trace id</li><li>saddr, daddr</li><li>sport, dport</li><li>ttl</li><li>handle of that rule</li></ul><p>if you want to enable tracing for a complete chain or before the input rules are processed you can add a tracing chain.
<a href="https://wiki.nftables.org/wiki-nftables/index.php/ruleset_debug/tracing#:~:text=same%20trace%20session.-,complete%20example,-here%20is%20complete">here</a> is a good example how you can do that.</p><h2 id=nftables-with-nixos>nftables with nixos</h2><p>nftables can be enabled with the nixos setting <code>nix network.nftables.enable = true;</code>. this will add the <strong>pkgs.nftables</strong> to your system environment and create a default ruleset for your system.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># default name nixos-fw, inet is for ipv4 and ipv6 traffic</span>
</span></span><span style=display:flex><span>table inet nixos-fw <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># chain for reverse path filtering and dhcp</span>
</span></span><span style=display:flex><span>    chain rpfilter <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># this will change the priority of mangle to 10 and a default chain policy to drop</span>
</span></span><span style=display:flex><span>        type filter hook prerouting priority mangle + 10; policy drop;
</span></span><span style=display:flex><span>        <span style=color:#75715e># this will open dhcpv4 on port 68 and 67 bootp</span>
</span></span><span style=display:flex><span>        meta nfproto ipv4 udp sport . udp dport <span style=color:#f92672>{</span> <span style=color:#ae81ff>68</span> . 67, <span style=color:#ae81ff>67</span> . <span style=color:#ae81ff>68</span> <span style=color:#f92672>}</span> accept comment <span style=color:#e6db74>&#34;dhcpv4 client/server&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># check reverse path, see cfg.checkreversepath</span>
</span></span><span style=display:flex><span>        fib saddr . mark . iif oif exists accept
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># default input chain</span>
</span></span><span style=display:flex><span>    chain input <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># filter with default drop policy</span>
</span></span><span style=display:flex><span>        type filter hook input priority filter; policy drop;
</span></span><span style=display:flex><span>        <span style=color:#75715e># lo is a trusted interface, see networking.firewall.trustedinterfaces</span>
</span></span><span style=display:flex><span>        iifname <span style=color:#e6db74>&#34;lo&#34;</span> accept comment <span style=color:#e6db74>&#34;trusted interfaces&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># track the state of the conntrack, new and untracked will handled in input-allow</span>
</span></span><span style=display:flex><span>        ct state vmap <span style=color:#f92672>{</span> invalid : drop, established : accept, related : accept, new : jump input-allow, untracked : jump input-allow <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># allow dhcpv6 without any trusted ports defined in networking.firewall.allowedtcpports</span>
</span></span><span style=display:flex><span>    chain input-allow <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        icmpv6 type !<span style=color:#f92672>=</span> <span style=color:#f92672>{</span> nd-redirect, <span style=color:#ae81ff>139</span> <span style=color:#f92672>}</span> accept comment <span style=color:#e6db74>&#34;accept all icmpv6 messages except redirects and node information queries (type 139).  see rfc 4890, section 4.4.&#34;</span>
</span></span><span style=display:flex><span>        ip6 daddr fe80::/64 udp dport <span style=color:#ae81ff>546</span> accept comment <span style=color:#e6db74>&#34;dhcpv6 client&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>this is the default ruleset when nftables is enabled on a nixos system and you have no additional options.
you can see the function of each instruction in the comments or look into the nixos modules.
other interesting options can find under ```nix network.firewall``:</p><ul><li>logreversepathdrops</li><li>logrefusedconnections</li><li>logrefusedpackets</li><li>logrefusedunicastsonly</li><li>rejectpackets</li><li>allowping</li><li>pinglimit</li></ul><p>take a look at <a href="https://search.nixos.org/options?channel=23.11&amp;from=0&amp;size=50&amp;sort=relevance&amp;type=packages&amp;query=firewall">nixos options</a> for a detailed explaination of each option.</p><p>this is my default configuration for a normal system without advanced routing stuff.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>networking <span style=color:#960050;background-color:#1e0010>=</span> {
</span></span><span style=display:flex><span>  firewall <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>      logrefusedconnections <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;        <span style=color:#75715e># disable logging of refuded connections</span>
</span></span><span style=display:flex><span>      logrefusedpackets <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;            <span style=color:#75715e># disable logging of refused packages</span>
</span></span><span style=display:flex><span>      allowping <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;                     <span style=color:#75715e># allow ping for diagnostics</span>
</span></span><span style=display:flex><span>      interfaces<span style=color:#f92672>.</span>eth0 <span style=color:#f92672>=</span> {                   <span style=color:#75715e># allow wireguard connections from the internet</span>
</span></span><span style=display:flex><span>        allowedudpports <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>            meta<span style=color:#f92672>.</span><span style=color:#e6db74>${</span>config<span style=color:#f92672>.</span>networking<span style=color:#f92672>.</span>hostname<span style=color:#e6db74>}</span><span style=color:#f92672>.</span>wg<span style=color:#f92672>.</span>port
</span></span><span style=display:flex><span>        ];
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      interfaces<span style=color:#f92672>.</span>wg0 <span style=color:#f92672>=</span> {                    <span style=color:#75715e># internal wireguard services</span>
</span></span><span style=display:flex><span>        allowedtcpports <span style=color:#f92672>=</span> [ <span style=color:#ae81ff>22</span> <span style=color:#ae81ff>53</span> ];        <span style=color:#75715e># allow internal ssh and dns via tcp connections</span>
</span></span><span style=display:flex><span>        allowedudpports <span style=color:#f92672>=</span> [ <span style=color:#ae81ff>53</span> ];           <span style=color:#75715e># allow internal dns via upd (default for dns queries)</span>
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><p>this config allows only wireguard connections to a open port to the internet.</p><p>internal services like ssh and dns connections are accessable via internal wireguard.
this will protect the system for unallowed ssh connection attemps from outside and reduce the attack options.</p><p>log for refuded connections and packets are disabled because i dont need it.</p><div class=speechbubble><div class=garry><img src=https://ripx80.de/images/garry-64.webp alt=garry></div><div class=chat><p><span class=whisper></span>
meta is a git-encrypt file which contains ip addresses, port numbers and other stuff that are not to be landed in git's cleartext history. normaly you will add here your wireguard port number as integer</p></div></div><h2 id=conclusion>conclusion</h2><p>now i have the basics that i need to setup a simple packet filter on my nixos hosts and debug the current rule set.
i can only recommend looking into the sources given to familiarize yourself with the whole topic.</p><p>time to get hands dirty for the real project of this journey: the nixos wireguard router with vpn support (comming soon).</p><h2 id=docs>docs</h2><ul><li><a href=https://wiki.nftables.org/wiki-nftables/index.php/main_page>wiki</a></li><li><a href="https://git.netfilter.org/nftables/log/doc?showmsg=1">timeline log</a> of nft development</li><li><a href=https://wiki.nftables.org/wiki-nftables/index.php/quick_reference-nftables_in_10_minutes>nft in 10 minutes</a></li><li><a href=https://scvalex.net/posts/54/>nftables on nixos</a></li><li><a href=https://wiki.nftables.org/wiki-nftables/index.php/flowtables>flowtables</a></li><li><a href=https://docs.kernel.org/networking/nf_flowtable.html>flowtables kernel</a></li><li><a href="https://thermalcircle.de/doku.php?id=blog:linux:flowtables_1_a_netfilter_nftables_fastpath">deep explaination of flowtables</a></li><li><a href=https://francis.begyn.be/blog/nixos-home-router>nixos-home-router</a></li><li><a href=https://pavluk.org/blog/2022/01/26/nixos_router.html>nixos-router</a></li><li><a href=https://www.procustodibus.com/blog/2021/11/wireguard-nftables/>wireguard nftables</a></li></ul><h2 id=learned>learned</h2><ul><li><a href=https://www.kernel.org/doc/documentation/networking/ip-sysctl.txt>difference</a> between net.ipv4.conf.all.forwarding and net.ipv4.ip_forward.</li><li>sysctl &ndash;system shows all system settings without a config file</li><li>ip mangle table: it is basically used to set specific headers for ip packets to affect the routing decision made further on. like mtu or ttl.</li><li>nixos opens automaticly dhcp ipv4 and ipv6 ports when networking.firewall.enable = true.</li><li>nixos networking.firewall.checkreversepath is default true</li><li>libressl-3.8.2-nc is a dependency of libressl-3.8.2 which is part of gibc of all nixos systems, so nc is available on default
nix-store &ndash;tree &ndash;query /nix/store/kvkiy1i5d1mh4q3rylsy4qshsrgsimaa-libressl-3.8.2-nc</li><li>refreshing netcat commands</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>nc host port <span style=color:#f92672>(</span>tcp connection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>nc -u host port <span style=color:#f92672>(</span>udp connection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>nc -z -v domain.com 1-1000 <span style=color:#75715e># port scanning</span>
</span></span><span style=display:flex><span>nc -l <span style=color:#ae81ff>4444</span> <span style=color:#75715e># listen</span>
</span></span><span style=display:flex><span>nc -l <span style=color:#ae81ff>4444</span> &gt; received_file <span style=color:#75715e># files through</span>
</span></span><span style=display:flex><span>nc domain.com <span style=color:#ae81ff>4444</span> &lt; original_file
</span></span><span style=display:flex><span>nc <span style=color:#e6db74>&#39;http/1.1 200 ok\n\n%s&#39;</span> <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>cat index.html<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> | netcat -l <span style=color:#ae81ff>8888</span> <span style=color:#75715e># http://server_ip:8888</span>
</span></span></code></pre></td></tr></table></div></div></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>home</a></li><li><a href=/posts>writings</a></li><li><a href=/lib>lib</a></li><li><a href=/tags>tags</a></li><li><a href=/whoami>whoami</a></li></ul></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f&text=nftables%20-%20basics" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f&title=nftables%20-%20basics" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f&is_video=false&description=nftables%20-%20basics" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=nftables%20-%20basics&body=Check out this article: https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f&title=nftables%20-%20basics" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f&title=nftables%20-%20basics" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f&name=nftables%20-%20basics&description=overview%20of%20the%20use%20of%20nftables%20with%20nix" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fripx80.de%2fposts%2f04-nftables%2f&t=nftables%20-%20basics" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; ripx80</div><div class=footer-right><nav><ul><li><a href=/>home</a></li><li><a href=/posts>writings</a></li><li><a href=/lib>lib</a></li><li><a href=/tags>tags</a></li><li><a href=/whoami>whoami</a></li><li><a href=https://ripx80.de/legal>legal notice</a></li><li><a href=https://ripx80.de/privacy>pricacy policy</a></li></ul></nav></div></footer><div id=cookies>if you use this site you accept the usage of cookies. take a closer look under <a href=https://ripx80.de/privacy>privacy policy</a>
<button id=cookies-btn>accept</button></div><script src=https://ripx80.de/js/custom.js defer></script></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script><script src=/js/code-copy.js></script></html>