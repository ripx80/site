<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>| ripx80 onexec</title>
<link rel=canonical href=https://ripx80.de/posts/drafts/10-metavoice/><meta name=description content="ripx80 technical thoughts and try to memorize yesterday"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content><meta property="og:description" content="metavoice you need cuda support if you have no cuda support you get compile errors and no working server nvidia on nixos 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 #hardware.nvidia.package = config.boot.kernelPackages.nvidiaPackages.stable; #550.78-6.10.6 hardware.nvidia.package = config.boot.kernelPackages.nvidiaPackages.beta; # 550.78-6.10.6 #hardware.nvidia.package = config.boot.kernelPackages.nvidiaPackages.latest; # 550.78-6.10.6 #hardware.nvidia.package = config.boot.kernelPackages.nvidiaPackages.production; #550.78-6.10.6 # hardware.nvidia.package = config.boot.kernelPackages.nvidiaPackages.mkDriver { # version = &#34;555."><meta property="og:type" content="article"><meta property="og:url" content="https://ripx80.de/posts/drafts/10-metavoice/"><meta property="article:section" content="posts"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="metavoice you need cuda support if you have no cuda support you get compile errors and no working server nvidia on nixos 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 #hardware.nvidia.package = config.boot.kernelPackages.nvidiaPackages.stable; #550.78-6.10.6 hardware.nvidia.package = config.boot.kernelPackages.nvidiaPackages.beta; # 550.78-6.10.6 #hardware.nvidia.package = config.boot.kernelPackages.nvidiaPackages.latest; # 550.78-6.10.6 #hardware.nvidia.package = config.boot.kernelPackages.nvidiaPackages.production; #550.78-6.10.6 # hardware.nvidia.package = config.boot.kernelPackages.nvidiaPackages.mkDriver { # version = &#34;555."><link rel=stylesheet href=https://ripx80.de/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><link rel=stylesheet href=https://ripx80.de/css/custom.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://ripx80.de/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>home</a></li><li><a href=/posts>writings</a></li><li><a href=/lib>lib</a></li><li><a href=/tags>tags</a></li><li><a href=/whoami>whoami</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://ripx80.de/lib/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=https://ripx80.de/posts/drafts/09-satisfactory/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f&text=" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f&title=" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f&is_video=false&description=" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=&body=Check out this article: https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f&title=" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f&title=" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f&name=&description=metavoice%20you%20need%20cuda%20support%20if%20you%20have%20no%20cuda%20support%20you%20get%20compile%20errors%20and%20no%20working%20server%20nvidia%20on%20nixos%201%202%203%204%205%206%207%208%209%2010%2011%2012%2013%2014%2015%2016%2017%2018%2019%2020%2021%2022%20%23hardware.nvidia.package%20%3d%20config.boot.kernelPackages.nvidiaPackages.stable%3b%20%23550.78-6.10.6%20hardware.nvidia.package%20%3d%20config.boot.kernelPackages.nvidiaPackages.beta%3b%20%23%20550.78-6.10.6%20%23hardware.nvidia.package%20%3d%20config.boot.kernelPackages.nvidiaPackages.latest%3b%20%23%20550.78-6.10.6%20%23hardware.nvidia.package%20%3d%20config.boot.kernelPackages.nvidiaPackages.production%3b%20%23550.78-6.10.6%20%23%20hardware.nvidia.package%20%3d%20config.boot.kernelPackages.nvidiaPackages.mkDriver%20%7b%20%23%20version%20%3d%20%26%2334%3b555." aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f&t=" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline"></h1><div class=meta><div class=postdate><time datetime="0001-01-01 00:00:00 +0000 UTC" itemprop=datePublished>0001-01-01</time></div><div class=article-read-time><i class="far fa-clock"></i>
4 minute read</div></div></header><div id=toc><nav id=TableOfContents><ul><li><a href=#nvidia-on-nixos>nvidia on nixos</a></li><li><a href=#cuda-on-nix>cuda on nix</a></li><li><a href=#run-inside-metavoice-server>run inside metavoice-server</a></li><li><a href=#finetune-eneral>finetune eneral</a></li><li><a href=#finetune-in-german>finetune in german</a><ul><li><a href=#finetune-special-letters>finetune special letters</a></li></ul></li><li><a href=#rec-your-voice>rec your voice</a></li><li><a href=#info>info</a><ul><li><a href=#incompatible-dependencies>incompatible dependencies</a></li></ul></li></ul></nav></div><div class=content itemprop=articleBody><h1 id=metavoice>metavoice</h1><ul><li>you need cuda support</li><li>if you have no cuda support you get compile errors and no working server</li></ul><h2 id=nvidia-on-nixos>nvidia on nixos</h2><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e>#hardware.nvidia.package = config.boot.kernelPackages.nvidiaPackages.stable; #550.78-6.10.6</span>
</span></span><span style=display:flex><span>  hardware.nvidia.package <span style=color:#f92672>=</span> config.boot.kernelPackages.nvidiaPackages.beta; <span style=color:#75715e># 550.78-6.10.6</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#hardware.nvidia.package = config.boot.kernelPackages.nvidiaPackages.latest; # 550.78-6.10.6</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#hardware.nvidia.package = config.boot.kernelPackages.nvidiaPackages.production; #550.78-6.10.6</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#   hardware.nvidia.package = config.boot.kernelPackages.nvidiaPackages.mkDriver {</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#         version = &#34;555.58.02&#34;;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#         sha256_64bit = &#34;sha256-xctt4TPRlOJ6r5S54h5W6PT6/3Zy2R4ASNFPu8TSHKM=&#34;;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#         sha256_aarch64 = &#34;sha256-8hyRiGB+m2hL3c9MDA/Pon+Xl6E788MZ50WrrAGUVuY=&#34;;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#         openSha256 = &#34;sha256-8hyRiGB+m2hL3c9MDA/Pon+Xl6E788MZ50WrrAGUVuY=&#34;;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#         settingsSha256 = &#34;sha256-ZpuVZybW6CFN/gz9rx+UJvQ715FZnAOYfHn5jt5Z2C8=&#34;;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#         persistencedSha256 = &#34;sha256-xctt4TPRlOJ6r5S54h5W6PT6/3Zy2R4ASNFPu8TSHKM=&#34;;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#     };</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#boot.kernelPackages = pkgs.linuxPackages_latest;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#   hardware.nvidia.package = config.boot.kernelPackages.nvidiaPackages.mkDriver {</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#   version = &#34;560.35.03&#34;;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#   sha256_64bit = &#34;sha256-8pMskvrdQ8WyNBvkU/xPc/CtcYXCa7ekP73oGuKfH+M=&#34;;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#   sha256_aarch64 = &#34;&#34;;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#   openSha256 = &#34;&#34;;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#   settingsSha256 = &#34;sha256-kQsvDgnxis9ANFmwIwB7HX5MkIAcpEEAHc8IBOLdXvk=&#34;;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#   persistencedSha256 = &#34;&#34;;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># };</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=cuda-on-nix>cuda on nix</h2><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>
</span></span><span style=display:flex><span>  environment.systemPackages <span style=color:#f92672>=</span> with pkgs; <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>    nvidia-container-toolkit
</span></span><span style=display:flex><span>    cudatoolkit
</span></span><span style=display:flex><span>  <span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>  hardware.nvidia-container-toolkit.enable <span style=color:#f92672>=</span> true;
</span></span><span style=display:flex><span>  hardware.nvidia-container-toolkit.mount-nvidia-executables <span style=color:#f92672>=</span> true;
</span></span><span style=display:flex><span>  hardware.nvidia.package <span style=color:#f92672>=</span> config.boot.kernelPackages.nvidiaPackages.beta;
</span></span></code></pre></td></tr></table></div></div><p>check if on server nvidia run correctly</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>nvidia-smi
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>+-----------------------------------------------------------------------------------------+
</span></span><span style=display:flex><span>| NVIDIA-SMI 550.78                 Driver Version: 550.78         CUDA Version: 12.4     |
</span></span><span style=display:flex><span>|-----------------------------------------+------------------------+----------------------+
</span></span><span style=display:flex><span>| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
</span></span><span style=display:flex><span>| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
</span></span><span style=display:flex><span>|                                         |                        |               MIG M. |
</span></span><span style=display:flex><span>|<span style=color:#f92672>=========================================</span>+<span style=color:#f92672>========================</span>+<span style=color:#f92672>======================</span>|
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>0</span>  NVIDIA GeForce RTX <span style=color:#ae81ff>4090</span>        Off |   00000000:0E:00.0  On |                  Off |
</span></span><span style=display:flex><span>|  0%   43C    P2             54W /  450W |   18131MiB /  24564MiB |      0%      Default |
</span></span><span style=display:flex><span>|                                         |                        |                  N/A |
</span></span><span style=display:flex><span>+-----------------------------------------+------------------------+----------------------+
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>+-----------------------------------------------------------------------------------------+
</span></span><span style=display:flex><span>| Processes:                                                                              |
</span></span><span style=display:flex><span>|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |
</span></span><span style=display:flex><span>|        ID   ID                                                               Usage      |
</span></span><span style=display:flex><span>|<span style=color:#f92672>=========================================================================================</span>|
</span></span><span style=display:flex><span>|    <span style=color:#ae81ff>0</span>   N/A  N/A      <span style=color:#ae81ff>1765</span>      G   ...iz78r52md-xorg-server-21.1.13/bin/X        288MiB |
</span></span><span style=display:flex><span>|    <span style=color:#ae81ff>0</span>   N/A  N/A      <span style=color:#ae81ff>1880</span>      G   ...seed-version<span style=color:#f92672>=</span>20241006-180150.222000         62MiB |
</span></span><span style=display:flex><span>|    <span style=color:#ae81ff>0</span>   N/A  N/A      <span style=color:#ae81ff>2495</span>      G   ...erProcess --variations-seed-version        115MiB |
</span></span><span style=display:flex><span>|    <span style=color:#ae81ff>0</span>   N/A  N/A     <span style=color:#ae81ff>78246</span>      G   alacritty                                      15MiB |
</span></span><span style=display:flex><span>|    <span style=color:#ae81ff>0</span>   N/A  N/A     <span style=color:#ae81ff>78686</span>      C   /app/.venv/bin/python                        8600MiB |
</span></span><span style=display:flex><span>|    <span style=color:#ae81ff>0</span>   N/A  N/A     <span style=color:#ae81ff>78765</span>      C   /app/.venv/bin/python                        9004MiB |
</span></span><span style=display:flex><span>|    <span style=color:#ae81ff>0</span>   N/A  N/A     <span style=color:#ae81ff>84675</span>      G   alacritty                                      15MiB |
</span></span><span style=display:flex><span>+-----------------------------------------------------------------------------------------
</span></span></code></pre></td></tr></table></div></div><p>then generate the cdi mapping for your card.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo nvidia-ctk cdi generate --output<span style=color:#f92672>=</span>/etc/cdi/nvidia.yaml <span style=color:#75715e># need to be in /etc/cdi</span>
</span></span><span style=display:flex><span>nvidia-ctk cdi list <span style=color:#75715e># list your mapping</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>INFO[0000] Found 2 CDI devices
</span></span><span style=display:flex><span>nvidia.com/gpu=0
</span></span><span style=display:flex><span>nvidia.com/gpu=all
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>podman run --rm --device nvidia.com/gpu<span style=color:#f92672>=</span>all --security-opt<span style=color:#f92672>=</span>label<span style=color:#f92672>=</span>disable ubuntu nvidia-smi -L <span style=color:#75715e># check if the container has access</span>
</span></span></code></pre></td></tr></table></div></div><p>you dont need nvidia-smi installed, this will be <a href=https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/cdi-support.html>handled by cdi</a>
then you must check your docker-compose file if you have the device section.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># podman run --rm --device nvidia.com/gpu=all --security-opt=label=disable ubuntu nvidia-smi -L</span>
</span></span><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3.8&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>resource_test</span>: <span style=color:#75715e># this is not working</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ubuntu:20.04</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>devices</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>nvidia.com/gpu=all</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>security_opt</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>label:disable</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tty</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>stdin_open</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>bash</span>
</span></span><span style=display:flex><span>      - -<span style=color:#ae81ff>c</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>nvidia-smi</span>
</span></span></code></pre></td></tr></table></div></div><p>attention: dont set the NVIDIA_VISIBLE_DEVICES env var if you use cdi.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>Using CDI to inject NVIDIA devices can conflict with using the NVIDIA Container Runtime hook. This means that if a /usr/share/containers/oci/hooks.d/oci-nvidia-hook.json file exists, delete it or ensure that you do not run containers with the NVIDIA_VISIBLE_DEVICES environment variable set.
</span></span></code></pre></td></tr></table></div></div><h2 id=run-inside-metavoice-server>run inside metavoice-server</h2><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>podman run -it --rm --device nvidia.com/gpu<span style=color:#f92672>=</span>all --security-opt<span style=color:#f92672>=</span>label<span style=color:#f92672>=</span>disable --entrypoint /bin/bash 12eba4ef06ae
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>poetry run python -i fam/llm/fast_inference.py
</span></span><span style=display:flex><span>tts.synthesise<span style=color:#f92672>(</span>text<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;This is a demo of text to speech by MetaVoice-1B, an open-source foundational audio model.&#34;</span>, spk_ref_path<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;assets/bria.mp3&#34;</span><span style=color:#f92672>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=finetune-eneral>finetune eneral</h2><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># expect a &#34;|&#34;-delimited CSV dataset</span>
</span></span><span style=display:flex><span><span style=color:#75715e># audio_files|captions</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#./data/audio.wav|./data/caption.txt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># train</span>
</span></span><span style=display:flex><span>poetry run finetune --train ./datasets/sample_dataset.csv --val ./datasets/sample_val_dataset.csv
</span></span><span style=display:flex><span><span style=color:#75715e># use it</span>
</span></span><span style=display:flex><span>poetry run python -i fam/llm/fast_inference.py --first_stage_path ./my-finetuned_model.pt
</span></span></code></pre></td></tr></table></div></div><h2 id=finetune-in-german>finetune in german</h2><p><a href=https://opendata.iisys.de/dataset/hui-audio-corpus-german/>dataset project</a>
<a href=https://opendata.iisys.de/opendata/Datasets/HUI-Audio-Corpus-German/dataset_clean/others_Clean.zip>dataset other clean</a>
<a href=https://github.com/iisys-hof/HUI-Audio-Corpus-German>dataset repo</a>
<a href="https://www.youtube.com/watch?v=r7BLbwxuJwk">expl video</a>
<a href="https://colab.research.google.com/drive/1ob-Q_9kJvH0F2pJ_JoWaIV9doGTsehV7#scrollTo=15uTrv0_wqn1">colab</a>
<a href=https://github.com/kotoba-tech/kotoba-speech-release>japanese training</a></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl https://opendata.iisys.de/opendata/Datasets/HUI-Audio-Corpus-German/dataset_clean/others_Clean.zip -o dataset-others-clean.zip
</span></span><span style=display:flex><span>unzip dataset-others-clean.zip -d dataset
</span></span></code></pre></td></tr></table></div></div><p>todo: end here</p><p>then transform to ljspeech format</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># format: dataset/&lt;sample_name&gt;.wav|transcription</span>
</span></span><span style=display:flex><span>from glob import glob
</span></span><span style=display:flex><span>import csv
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>transcribed_audio_samples <span style=color:#f92672>=</span> <span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> folder in glob<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;others_dataset/*&#34;</span><span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> subfolder in glob<span style=color:#f92672>(</span>f<span style=color:#e6db74>&#34;{folder}/*&#34;</span><span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>    with open<span style=color:#f92672>(</span>f<span style=color:#e6db74>&#34;{subfolder}/metadata.csv&#34;</span><span style=color:#f92672>)</span> as csv_file:
</span></span><span style=display:flex><span>        audio_samples <span style=color:#f92672>=</span> csv.reader<span style=color:#f92672>(</span>csv_file, delimiter<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;\n&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> audio_sample in audio_samples:
</span></span><span style=display:flex><span>            transcribed_audio_sample <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>.join<span style=color:#f92672>(</span>audio_sample<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            filename, transcription <span style=color:#f92672>=</span> transcribed_audio_sample.split<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;|&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            new_transcribed_audio_sample <span style=color:#f92672>=</span> f<span style=color:#e6db74>&#34;wavs/{filename}.wav|{transcription}&#34;</span>
</span></span><span style=display:flex><span>            transcribed_audio_samples.append<span style=color:#f92672>((</span>f<span style=color:#e6db74>&#34;{subfolder}/wavs/{filename}.wav&#34;</span>, new_transcribed_audio_sample<span style=color:#f92672>))</span>
</span></span></code></pre></td></tr></table></div></div><p>devide dataset into train and val subsets</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> random
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>random<span style=color:#f92672>.</span>shuffle(all_transcribed_audio_samples)
</span></span><span style=display:flex><span>num_train_samples <span style=color:#f92672>=</span> int(len(all_transcribed_audio_samples) <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.85</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>train_dataset <span style=color:#f92672>=</span> transcribed_audio_samples[:num_train_samples]
</span></span><span style=display:flex><span>val_dataset <span style=color:#f92672>=</span> transcribed_audio_samples[num_train_samples:]
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>mkdir dataset
</span></span><span style=display:flex><span>mkdir dataset/wavs
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> shutil
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>train_val_list <span style=color:#f92672>=</span> [(<span style=color:#e6db74>&#39;train&#39;</span>, train_dataset), (<span style=color:#e6db74>&#39;val&#39;</span>, val_dataset)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> stage, dataset <span style=color:#f92672>in</span> train_val_list:
</span></span><span style=display:flex><span>    sample_list <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> old_sample, new_sample <span style=color:#f92672>in</span> dataset:
</span></span><span style=display:flex><span>        <span style=color:#75715e># copy audio sample to new location</span>
</span></span><span style=display:flex><span>        shutil<span style=color:#f92672>.</span>copyfile(old_sample, <span style=color:#e6db74>&#34;./dataset/&#34;</span> <span style=color:#f92672>+</span> new_sample<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;|&#34;</span>)[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>        sample_list<span style=color:#f92672>.</span>append(new_sample)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;./dataset/</span><span style=color:#e6db74>{</span>stage<span style=color:#e6db74>}</span><span style=color:#e6db74>.txt&#34;</span>, <span style=color:#e6db74>&#34;w&#34;</span>) <span style=color:#66d9ef>as</span> sample_file:
</span></span><span style=display:flex><span>        sample_file<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>join(sample_list))
</span></span></code></pre></td></tr></table></div></div><p>packing</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>zip -r hui_audio_corpus.zip ./dataset
</span></span></code></pre></td></tr></table></div></div><h3 id=finetune-special-letters>finetune special letters</h3><h2 id=rec-your-voice>rec your voice</h2><ul><li>you need min. 30 seconds</li><li>read some of <a href=https://www.cs.cmu.edu/~spok/grimmtmp/009.txt>rapunzel</a></li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>arecord -l <span style=color:#75715e># get your input device</span>
</span></span><span style=display:flex><span>ffmpeg -f alsa -i hw:0 -t <span style=color:#ae81ff>60</span> out.wav
</span></span><span style=display:flex><span>ffmpeg -i out.wav -filter:a <span style=color:#e6db74>&#34;volume=1.5&#34;</span> output.wav <span style=color:#75715e># increase volume</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ffmpeg -f alsa -sample_fmt s16 -ar <span style=color:#ae81ff>48000</span> -i hw:0 out.wav
</span></span><span style=display:flex><span>ffmpeg -f alsa -sample_fmt pcm_s16le -sample_rate <span style=color:#ae81ff>48000</span> -i hw:0 out.wav <span style=color:#75715e># best qual.</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=info>info</h2><ul><li><a href=https://github.com/metavoiceio/MetaVoiceLive>metavoice-live</a></li></ul><h3 id=incompatible-dependencies>incompatible dependencies</h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>ERROR: pip&#39;s dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.
</span></span><span style=display:flex><span>audiocraft 1.2.0 requires torch==2.1.0, but you have torch 2.2.1 which is incompatible.
</span></span><span style=display:flex><span>xformers 0.0.22.post7 requires torch==2.1.0, but you have torch 2.2.1 which is incompatible.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PyTorch 2.1.0+cu121 with CUDA 1201 (you have 2.2.1+cu121)
</span></span><span style=display:flex><span>Python  3.10.13 (you have 3.10.12)
</span></span><span style=display:flex><span>  Please reinstall xformers (see &lt;https://github.com/facebookresearch/xformers#installing-xformers&gt;)
</span></span></code></pre></td></tr></table></div></div><p>don&rsquo;t worry, ignore it.</p></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>home</a></li><li><a href=/posts>writings</a></li><li><a href=/lib>lib</a></li><li><a href=/tags>tags</a></li><li><a href=/whoami>whoami</a></li></ul></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f&text=" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f&title=" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f&is_video=false&description=" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=&body=Check out this article: https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f&title=" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f&title=" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f&name=&description=metavoice%20you%20need%20cuda%20support%20if%20you%20have%20no%20cuda%20support%20you%20get%20compile%20errors%20and%20no%20working%20server%20nvidia%20on%20nixos%201%202%203%204%205%206%207%208%209%2010%2011%2012%2013%2014%2015%2016%2017%2018%2019%2020%2021%2022%20%23hardware.nvidia.package%20%3d%20config.boot.kernelPackages.nvidiaPackages.stable%3b%20%23550.78-6.10.6%20hardware.nvidia.package%20%3d%20config.boot.kernelPackages.nvidiaPackages.beta%3b%20%23%20550.78-6.10.6%20%23hardware.nvidia.package%20%3d%20config.boot.kernelPackages.nvidiaPackages.latest%3b%20%23%20550.78-6.10.6%20%23hardware.nvidia.package%20%3d%20config.boot.kernelPackages.nvidiaPackages.production%3b%20%23550.78-6.10.6%20%23%20hardware.nvidia.package%20%3d%20config.boot.kernelPackages.nvidiaPackages.mkDriver%20%7b%20%23%20version%20%3d%20%26%2334%3b555." aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fripx80.de%2fposts%2fdrafts%2f10-metavoice%2f&t=" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; ripx80</div><div class=footer-right><nav><ul><li><a href=/>home</a></li><li><a href=/posts>writings</a></li><li><a href=/lib>lib</a></li><li><a href=/tags>tags</a></li><li><a href=/whoami>whoami</a></li><li><a href=https://ripx80.de/legal>legal notice</a></li><li><a href=https://ripx80.de/privacy>pricacy policy</a></li></ul></nav></div></footer><div id=cookies>if you use this site you accept the usage of cookies. take a closer look under <a href=https://ripx80.de/privacy>privacy policy</a>
<button id=cookies-btn>accept</button></div><script src=https://ripx80.de/js/custom.js defer></script></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script><script src=/js/code-copy.js></script></html>